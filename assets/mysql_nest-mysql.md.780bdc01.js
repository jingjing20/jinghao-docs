import{_ as s,o as n,c as a,V as l}from"./chunks/framework.92369faf.js";const p="/jinghao-docs/assets/image.1d8ac5c9.png",o="/jinghao-docs/assets/image-1.72e97e93.png",e="/jinghao-docs/assets/image-2.09284d9e.png",r="/jinghao-docs/assets/image-3.6f9afae7.png",c="/jinghao-docs/assets/image-4.be6c1c0c.png",E=JSON.parse('{"title":"nest 小册 mysql 练习","description":"","frontmatter":{},"headers":[],"relativePath":"mysql/nest-mysql.md","filePath":"mysql/nest-mysql.md","lastUpdated":1692892408000}'),t={name:"mysql/nest-mysql.md"},C=l('<h1 id="nest-小册-mysql-练习" tabindex="-1">nest 小册 mysql 练习 <a class="header-anchor" href="#nest-小册-mysql-练习" aria-label="Permalink to &quot;nest 小册 mysql 练习&quot;">​</a></h1><h2 id="常用查询" tabindex="-1">常用查询 <a class="header-anchor" href="#常用查询" aria-label="Permalink to &quot;常用查询&quot;">​</a></h2><h3 id="准备练习数据表" tabindex="-1">准备练习数据表 <a class="header-anchor" href="#准备练习数据表" aria-label="Permalink to &quot;准备练习数据表&quot;">​</a></h3><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">-- 创建 customers 表，用于存储客户信息</span></span>\n<span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">TABLE</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">IF</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">NOT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">EXISTS</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">customers</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;"> (</span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">11</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">NOT NULL</span><span style="color:#A6ACCD;"> AUTO_INCREMENT COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">客户ID，自增长</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">varchar</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">255</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">NOT NULL</span><span style="color:#A6ACCD;"> COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">客户姓名，非空</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">PRIMARY KEY</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;">)</span></span>\n<span class="line"><span style="color:#A6ACCD;">) ENGINE</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">InnoDB </span><span style="color:#C792EA;">DEFAULT</span><span style="color:#A6ACCD;"> CHARSET</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">utf8mb4 COMMENT</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">客户信息表</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;">-- 创建 orders 表，用于存储订单信息</span></span>\n<span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">TABLE</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">IF</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">NOT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">EXISTS</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">orders</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;"> (</span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">11</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">NOT NULL</span><span style="color:#A6ACCD;"> AUTO_INCREMENT COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">订单ID，自增长</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">customer_id</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">11</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">NOT NULL</span><span style="color:#A6ACCD;"> COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">客户ID，非空</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">order_date</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">date</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">NOT NULL</span><span style="color:#A6ACCD;"> COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">订单日期，非空</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">total_amount</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">decimal</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">NOT NULL</span><span style="color:#A6ACCD;"> COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">订单总金额，非空</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">PRIMARY KEY</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;">),</span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">FOREIGN KEY</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">customer_id</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;">) </span><span style="color:#C792EA;">REFERENCES</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">customers</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;">) </span><span style="color:#C792EA;">ON DELETE CASCADE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">UPDATE</span><span style="color:#A6ACCD;"> CASCADE</span></span>\n<span class="line"><span style="color:#A6ACCD;">) ENGINE</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">InnoDB </span><span style="color:#C792EA;">DEFAULT</span><span style="color:#A6ACCD;"> CHARSET</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">utf8mb4 COMMENT</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">订单信息表</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;">-- 创建 order_items 表，用于存储订单商品信息</span></span>\n<span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">TABLE</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">IF</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">NOT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">EXISTS</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">order_items</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;"> (</span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">11</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">NOT NULL</span><span style="color:#A6ACCD;"> AUTO_INCREMENT COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">商品ID，自增长</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">order_id</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">11</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">NOT NULL</span><span style="color:#A6ACCD;"> COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">订单ID，非空</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">product_name</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">varchar</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">255</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">NOT NULL</span><span style="color:#A6ACCD;"> COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">商品名称，非空</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">quantity</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">11</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">NOT NULL</span><span style="color:#A6ACCD;"> COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">商品数量，非空</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">price</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">decimal</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">NOT NULL</span><span style="color:#A6ACCD;"> COMMENT </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">商品单价，非空</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">PRIMARY KEY</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;">),</span></span>\n<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">FOREIGN KEY</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">order_id</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;">) </span><span style="color:#C792EA;">REFERENCES</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">orders</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;">) </span><span style="color:#C792EA;">ON DELETE CASCADE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">UPDATE</span><span style="color:#A6ACCD;"> CASCADE</span></span>\n<span class="line"><span style="color:#A6ACCD;">) ENGINE</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">InnoDB </span><span style="color:#C792EA;">DEFAULT</span><span style="color:#A6ACCD;"> CHARSET</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">utf8mb4 COMMENT</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">订单商品信息表</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="往表里插入练习数据" tabindex="-1">往表里插入练习数据 <a class="header-anchor" href="#往表里插入练习数据" aria-label="Permalink to &quot;往表里插入练习数据&quot;">​</a></h3><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">-- 向 customers 表插入数据</span></span>\n<span class="line"><span style="color:#F78C6C;">INSERT INTO</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">customers</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;">)</span></span>\n<span class="line"><span style="color:#A6ACCD;">  	</span><span style="color:#F78C6C;">VALUES</span></span>\n<span class="line"><span style="color:#A6ACCD;">		(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">张丽娜</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">),(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">李明</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">),(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">王磊</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">),(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">赵静</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">),(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">钱伟</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">),</span></span>\n<span class="line"><span style="color:#A6ACCD;">		(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">孙芳</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">),(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">周涛</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">),(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">吴洋</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">),(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">郑红</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">),(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">刘华</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">),</span></span>\n<span class="line"><span style="color:#A6ACCD;">		(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">陈明</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">),(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">杨丽</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">),(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">王磊</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">),(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">张伟</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">),(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">李娜</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">),</span></span>\n<span class="line"><span style="color:#A6ACCD;">		(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">刘洋</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">),(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">陈静</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">),(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">杨阳</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">),(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">王丽</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">),(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">张强</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;">-- 向 orders 表插入数据</span></span>\n<span class="line"><span style="color:#F78C6C;">INSERT INTO</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">orders</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">customer_id</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">order_date</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">total_amount</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;">)</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">VALUES</span></span>\n<span class="line"><span style="color:#A6ACCD;">        (</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2022-01-01</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">100</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">),(</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2022-01-02</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">200</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">),</span></span>\n<span class="line"><span style="color:#A6ACCD;">        (</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2022-01-03</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">300</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">),(</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2022-01-04</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">400</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">),</span></span>\n<span class="line"><span style="color:#A6ACCD;">        (</span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2022-01-05</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">500</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">),(</span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2022-01-06</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">600</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">),</span></span>\n<span class="line"><span style="color:#A6ACCD;">        (</span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2022-01-07</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">700</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">),(</span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2022-01-08</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">800</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">),</span></span>\n<span class="line"><span style="color:#A6ACCD;">        (</span><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2022-01-09</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">900</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">),(</span><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2022-01-10</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">1000</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">);</span></span>\n<span class="line"></span>\n<span class="line"><span style="color:#676E95;font-style:italic;">-- 向 order_items 表插入数据</span></span>\n<span class="line"><span style="color:#F78C6C;">INSERT INTO</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">order_items</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">order_id</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">product_name</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">quantity</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">price</span><span style="color:#89DDFF;">`</span><span style="color:#A6ACCD;">)</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">VALUES</span></span>\n<span class="line"><span style="color:#A6ACCD;">        (</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">耐克篮球鞋</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">100</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">),</span></span>\n<span class="line"><span style="color:#A6ACCD;">        (</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">阿迪达斯跑步鞋</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">50</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">),</span></span>\n<span class="line"><span style="color:#A6ACCD;">        (</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">匡威帆布鞋</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">100</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">),</span></span>\n<span class="line"><span style="color:#A6ACCD;">        (</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">万斯板鞋</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">50</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">),</span></span>\n<span class="line"><span style="color:#A6ACCD;">        (</span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">新百伦运动鞋</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">100</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">),</span></span>\n<span class="line"><span style="color:#A6ACCD;">        (</span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">彪马休闲鞋</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">6</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">50</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">),</span></span>\n<span class="line"><span style="color:#A6ACCD;">        (</span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">锐步经典鞋</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">7</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">100</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">),</span></span>\n<span class="line"><span style="color:#A6ACCD;">        (</span><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">亚瑟士运动鞋</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">50</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">),</span></span>\n<span class="line"><span style="color:#A6ACCD;">        (</span><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">帆布鞋</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">100</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">),</span></span>\n<span class="line"><span style="color:#A6ACCD;">        (</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">苹果手写笔</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">50</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">),</span></span>\n<span class="line"><span style="color:#A6ACCD;">        (</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">电脑包</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">100</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">),</span></span>\n<span class="line"><span style="color:#A6ACCD;">        (</span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">苹果手机</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">50</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">),</span></span>\n<span class="line"><span style="color:#A6ACCD;">        (</span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">苹果耳机</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">100</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">),</span></span>\n<span class="line"><span style="color:#A6ACCD;">        (</span><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;">, </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">苹果平板</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">7</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">100</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="练习-1-查询每个客户的订单总金额" tabindex="-1">练习 1: 查询每个客户的订单总金额 <a class="header-anchor" href="#练习-1-查询每个客户的订单总金额" aria-label="Permalink to &quot;练习 1: 查询每个客户的订单总金额&quot;">​</a></h3><div class="info custom-block"><p class="custom-block-title">思路</p><p>客户的订单存在订单表里，每个客户的订单可以有多个，所以这里需要用 <code>JOIN ON</code> 关联两个表，然后用 <code>GROUP BY</code> 根据客户 <code>id</code> 分组，再通过 <code>SUM</code> 函数计算价格总和。</p></div><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> customers.name, </span><span style="color:#82AAFF;">SUM</span><span style="color:#A6ACCD;">(orders.total_amount) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> total_amount</span></span>\n<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> customers</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">JOIN</span><span style="color:#A6ACCD;"> orders </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> customers.id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> orders.customer_id</span></span>\n<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">GROUP BY</span><span style="color:#A6ACCD;"> customers.id</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>执行下查询语句，可以看到每个客户的订单总金额</li></ul><p><img src="'+p+`" alt="Alt text"></p><h4 id="可以加个排序" tabindex="-1">可以加个排序 <a class="header-anchor" href="#可以加个排序" aria-label="Permalink to &quot;可以加个排序&quot;">​</a></h4><ul><li>排序的时候，可以用 <code>ASC</code> 或者 <code>DESC</code> 来指定升序或降序，如果不指定，默认是升序。</li></ul><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> customers.name, </span><span style="color:#82AAFF;">SUM</span><span style="color:#A6ACCD;">(orders.total_amount) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> total_amount</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> customers</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">JOIN</span><span style="color:#A6ACCD;"> orders </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> customers.id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> orders.customer_id</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">GROUP BY</span><span style="color:#A6ACCD;"> customers.id</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">ORDER BY</span><span style="color:#A6ACCD;"> total_amount </span><span style="color:#F78C6C;">DESC</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="`+o+`" alt="Alt text"></p><h4 id="也可以加个查询数量限制" tabindex="-1">也可以加个查询数量限制 <a class="header-anchor" href="#也可以加个查询数量限制" aria-label="Permalink to &quot;也可以加个查询数量限制&quot;">​</a></h4><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> customers.name, </span><span style="color:#82AAFF;">SUM</span><span style="color:#A6ACCD;">(orders.total_amount) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> total_amount</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> customers</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">JOIN</span><span style="color:#A6ACCD;"> orders </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> customers.id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> orders.customer_id</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">GROUP BY</span><span style="color:#A6ACCD;"> customers.id</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">ORDER BY</span><span style="color:#A6ACCD;"> total_amount </span><span style="color:#F78C6C;">DESC</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">LIMIT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="`+e+`" alt="Alt text"></p><h3 id="练习-2-查询每个客户的订单总金额-并计算其占比" tabindex="-1">练习 2: 查询每个客户的订单总金额，并计算其占比 <a class="header-anchor" href="#练习-2-查询每个客户的订单总金额-并计算其占比" aria-label="Permalink to &quot;练习 2: 查询每个客户的订单总金额，并计算其占比&quot;">​</a></h3><ul><li>每个客户的总金额的需求上面实现了，这里只需要算占比</li><li>可以通过一个子查询来计算全部订单的总金额，然后再相除就可以了</li></ul><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> customers.name, </span><span style="color:#82AAFF;">SUM</span><span style="color:#A6ACCD;">(orders.total_amount) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> total_amount,</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">SUM</span><span style="color:#A6ACCD;">(orders.total_amount) </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> (</span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">SUM</span><span style="color:#A6ACCD;">(total_amount) </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> orders) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">percentage</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> customers</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">INNER JOIN</span><span style="color:#A6ACCD;"> orders </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> customers.id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> orders.customer_id</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">GROUP BY</span><span style="color:#A6ACCD;"> customers.id;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><img src="`+r+`" alt="Alt text"></p><h4 id="查询优化" tabindex="-1">查询优化 <a class="header-anchor" href="#查询优化" aria-label="Permalink to &quot;查询优化&quot;">​</a></h4><ul><li>这里每次都算一遍总金额性能不好，可以先算出总金额，然后把数值传入。</li></ul><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">-- 计算总订单金额</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">SUM</span><span style="color:#A6ACCD;">(total_amount) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> total_order_amount </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> orders </span><span style="color:#F78C6C;">INTO</span><span style="color:#A6ACCD;"> @total_amount;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- 使用计算得到的总订单金额进行查询</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> customers.name,</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">SUM</span><span style="color:#A6ACCD;">(orders.total_amount) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> total_amount,</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">SUM</span><span style="color:#A6ACCD;">(orders.total_amount) </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> @total_amount </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">percentage</span></span>
<span class="line"><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> customers</span></span>
<span class="line"><span style="color:#F78C6C;">INNER JOIN</span><span style="color:#A6ACCD;"> orders </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> customers.id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> orders.customer_id</span></span>
<span class="line"><span style="color:#F78C6C;">GROUP BY</span><span style="color:#A6ACCD;"> customers.id;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- 清除变量</span></span>
<span class="line"><span style="color:#F78C6C;">SET</span><span style="color:#A6ACCD;"> @total_amount </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">NULL</span><span style="color:#A6ACCD;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="练习-3-查询每个客户的订单总金额-并列出每个订单的商品清单" tabindex="-1">练习 3：查询每个客户的订单总金额，并列出每个订单的商品清单 <a class="header-anchor" href="#练习-3-查询每个客户的订单总金额-并列出每个订单的商品清单" aria-label="Permalink to &quot;练习 3：查询每个客户的订单总金额，并列出每个订单的商品清单&quot;">​</a></h3><ul><li>这里在总金额的基础上，多了订单项的查询，需要多关联一个表：<code>order_items</code></li></ul><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> customers.name, orders.order_date, orders.total_amount,</span></span>
<span class="line"><span style="color:#A6ACCD;">	order_items.product_name, order_items.quantity, order_items.price</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> customers</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">JOIN</span><span style="color:#A6ACCD;"> orders </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> customers.id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> orders.customer_id</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">JOIN</span><span style="color:#A6ACCD;"> order_items </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> orders.id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> order_items.order_id</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">ORDER BY</span><span style="color:#A6ACCD;"> customers.name, orders.order_date;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>内连接 3 个表，同时按照名字和下单日期排序。</li><li>多个字段排序的时候，可以用 <code>,</code> 分隔，也可以用 <code>AND</code> 连接。</li><li>这里用的是 <code>,</code> 分隔，先按照名字排序，如果名字相同，再按照下单日期排序。</li></ul><p><img src="`+c+`" alt="Alt text"></p><h4 id="可以过滤某个客户的订单" tabindex="-1">可以过滤某个客户的订单 <a class="header-anchor" href="#可以过滤某个客户的订单" aria-label="Permalink to &quot;可以过滤某个客户的订单&quot;">​</a></h4><ul><li>比如只查询 <code>张丽娜</code> 的订单</li></ul><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> customers.name, orders.order_date, orders.total_amount,</span></span>
<span class="line"><span style="color:#A6ACCD;">	order_items.product_name, order_items.quantity, order_items.price</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> customers</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">JOIN</span><span style="color:#A6ACCD;"> orders </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> customers.id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> orders.customer_id</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">JOIN</span><span style="color:#A6ACCD;"> order_items </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> orders.id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> order_items.order_id</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> customers.name </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">张丽娜</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">ORDER BY</span><span style="color:#A6ACCD;"> customers.name, orders.order_date;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="可以过滤某个时间段的订单" tabindex="-1">可以过滤某个时间段的订单 <a class="header-anchor" href="#可以过滤某个时间段的订单" aria-label="Permalink to &quot;可以过滤某个时间段的订单&quot;">​</a></h4><ul><li>比如查询 2022 年 1 月 1 日到 2022 年 1 月 3 日的订单</li></ul><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> customers.name, orders.order_date, orders.total_amount,</span></span>
<span class="line"><span style="color:#A6ACCD;">	order_items.product_name, order_items.quantity, order_items.price</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> customers</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">JOIN</span><span style="color:#A6ACCD;"> orders </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> customers.id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> orders.customer_id</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">JOIN</span><span style="color:#A6ACCD;"> order_items </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> orders.id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> order_items.order_id</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> orders.order_date </span><span style="color:#F78C6C;">BETWEEN</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2022-01-01</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">AND</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2022-01-03</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#F78C6C;">ORDER BY</span><span style="color:#A6ACCD;"> customers.name, orders.order_date;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>因为这里的 <code>order_date</code> 是 <code>date</code> 类型，所以指定范围也只是用 <code>2022-01-01</code> 这种格式的。如果是 <code>datetime</code>，那就要用 <code>2022-01-01 10:10:00</code> 这种格式了。</li><li><code>WHERE</code> 过滤的时候，可以用 <code>AND</code> 或者 <code>OR</code> 来连接多个条件，也可以用 <code>IN</code> 来过滤多个值。</li><li>还可以模糊匹配等等，这里不再赘述。详见上一篇文章：<a href="./mysql-bizhibihui.html">mysql 必知必会阅读笔记</a></li></ul><h3 id="练习-4-查询每个客户的订单总金额-并计算商品数量-只包含商品名称包含-鞋-的商品-商品名用-连接" tabindex="-1">练习 4：查询每个客户的订单总金额，并计算商品数量，只包含商品名称包含“鞋”的商品，商品名用-连接： <a class="header-anchor" href="#练习-4-查询每个客户的订单总金额-并计算商品数量-只包含商品名称包含-鞋-的商品-商品名用-连接" aria-label="Permalink to &quot;练习 4：查询每个客户的订单总金额，并计算商品数量，只包含商品名称包含“鞋”的商品，商品名用-连接：&quot;">​</a></h3><ul><li>查询订单总金额和商品数量都需要用 group by 根据 customer.id 分组</li><li>过滤出只包含鞋的商品</li><li>把分组的多条商品名连接起来需要用 GROUP_CONCAT 函数。</li></ul><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span></span>
<span class="line"><span style="color:#A6ACCD;">	c.name </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> customer_name,</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">SUM</span><span style="color:#A6ACCD;">(o.total_amount) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> total_amount,</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#82AAFF;">COUNT</span><span style="color:#A6ACCD;">(oi.id) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> total_quantity,</span></span>
<span class="line"><span style="color:#A6ACCD;">	GROUP_CONCAT(oi.product_name SEPARATOR </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">-</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">AS</span><span style="color:#A6ACCD;"> product_names</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> customers c</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">JOIN</span><span style="color:#A6ACCD;"> orders o </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> c.id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> o.customer_id</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">JOIN</span><span style="color:#A6ACCD;"> order_items oi </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> o.id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> oi.order_id</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> oi.product_name </span><span style="color:#F78C6C;">LIKE</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">%鞋%</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">GROUP BY</span><span style="color:#A6ACCD;"> c.name</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">ORDER BY</span><span style="color:#A6ACCD;"> total_amount </span><span style="color:#F78C6C;">DESC</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>GROUP_CONCAT 函数是用于 group by 分组后，把多个值连接成一个字符串的。</li></ul><h3 id="练习-5-将张丽娜的订单总金额打九折" tabindex="-1">练习 5：将张丽娜的订单总金额打九折 <a class="header-anchor" href="#练习-5-将张丽娜的订单总金额打九折" aria-label="Permalink to &quot;练习 5：将张丽娜的订单总金额打九折&quot;">​</a></h3><ul><li>这里用户名为王磊的用户不止一条，所以用 <code>IN</code> 来指定一个集合。</li></ul><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">UPDATE</span><span style="color:#A6ACCD;"> orders o </span><span style="color:#F78C6C;">SET</span><span style="color:#A6ACCD;"> o.total_amount </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> o.total_amount </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">9</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> o.customer_id </span><span style="color:#F78C6C;">IN</span><span style="color:#A6ACCD;"> (</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> id </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> customers </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">张丽娜</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    );</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div>`,44),y=[C];function D(A,F,i,d,m,u){return n(),a("div",null,y)}const h=s(t,[["render",D]]);export{E as __pageData,h as default};
