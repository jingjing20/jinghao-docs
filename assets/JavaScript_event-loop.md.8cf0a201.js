import{_ as s,o as n,c as a,V as l}from"./chunks/framework.364d6ed5.js";const C=JSON.parse('{"title":"äº‹ä»¶å¾ªç¯æœºåˆ¶","description":"","frontmatter":{},"headers":[],"relativePath":"JavaScript/event-loop.md","filePath":"JavaScript/event-loop.md","lastUpdated":1686842923000}'),p={name:"JavaScript/event-loop.md"},o=l(`<h1 id="äº‹ä»¶å¾ªç¯æœºåˆ¶" tabindex="-1">äº‹ä»¶å¾ªç¯æœºåˆ¶ <a class="header-anchor" href="#äº‹ä»¶å¾ªç¯æœºåˆ¶" aria-label="Permalink to &quot;äº‹ä»¶å¾ªç¯æœºåˆ¶&quot;">â€‹</a></h1><h2 id="ä¸€ã€æµè§ˆå™¨ä¸­çš„-javascript-äº‹ä»¶å¾ªç¯æœºåˆ¶" tabindex="-1">ä¸€ã€æµè§ˆå™¨ä¸­çš„ JavaScript äº‹ä»¶å¾ªç¯æœºåˆ¶ <a class="header-anchor" href="#ä¸€ã€æµè§ˆå™¨ä¸­çš„-javascript-äº‹ä»¶å¾ªç¯æœºåˆ¶" aria-label="Permalink to &quot;ä¸€ã€æµè§ˆå™¨ä¸­çš„ JavaScript äº‹ä»¶å¾ªç¯æœºåˆ¶&quot;">â€‹</a></h2><p>ä»ä¸€é“é¢è¯•é¢˜æ¥å­¦ä¹ æµè§ˆå™¨ä¸­çš„ JavaScript äº‹ä»¶å¾ªç¯æœºåˆ¶ï¼Œ é¢˜ç›®å¦‚ä¸‹ï¼šğŸ‘‡ ğŸ‘‡ ğŸ‘‡</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">async1</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">async1 start</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">async2</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">async1 end</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">async2</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">async2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">script start</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setTimeout</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">setTimeout</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">async1</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">promise1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">promise2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">script end</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>è¿™é“é¢˜ä¸»è¦è€ƒå¯Ÿçš„æ˜¯äº‹ä»¶å¾ªç¯ä¸­å‡½æ•°æ‰§è¡Œé¡ºåºçš„é—®é¢˜ï¼Œå…¶ä¸­åŒ…æ‹¬ <code>async</code> ï¼Œ<code>await</code>ï¼Œ<code>setTimeout</code>ï¼Œ<code>Promise</code>å‡½æ•°ã€‚</p><div class="tip custom-block"><p class="custom-block-title">æ¸©é¦¨æç¤º</p><p>å…ˆçœ‹çœ‹è§£é¢˜éœ€è¦å“ªäº›çŸ¥è¯†å‚¨å¤‡ï¼Œä¸€æ­¥ä¸€æ­¥æ¥è§£å†³å®ƒã€‚</p></div><h3 id="ä»»åŠ¡é˜Ÿåˆ—" tabindex="-1">ä»»åŠ¡é˜Ÿåˆ— <a class="header-anchor" href="#ä»»åŠ¡é˜Ÿåˆ—" aria-label="Permalink to &quot;ä»»åŠ¡é˜Ÿåˆ—&quot;">â€‹</a></h3><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦æ˜ç™½ä»¥ä¸‹å‡ ä»¶äº‹æƒ…ï¼š</p><ul><li>JS åˆ†ä¸ºåŒæ­¥ä»»åŠ¡å’Œå¼‚æ­¥ä»»åŠ¡</li><li>åŒæ­¥ä»»åŠ¡éƒ½åœ¨ä¸»çº¿ç¨‹ä¸Šæ‰§è¡Œï¼Œå½¢æˆä¸€ä¸ªæ‰§è¡Œæ ˆ</li><li>ä¸»çº¿ç¨‹ä¹‹å¤–ï¼Œäº‹ä»¶è§¦å‘çº¿ç¨‹ç®¡ç†ç€ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ï¼Œåªè¦å¼‚æ­¥ä»»åŠ¡æœ‰äº†è¿è¡Œç»“æœï¼Œå°±åœ¨ä»»åŠ¡é˜Ÿåˆ—ä¹‹ä¸­æ”¾ç½®ä¸€ä¸ªäº‹ä»¶ã€‚</li><li>ä¸€æ—¦æ‰§è¡Œæ ˆä¸­çš„æ‰€æœ‰åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼ˆæ­¤æ—¶ JS å¼•æ“ç©ºé—²ï¼‰ï¼Œç³»ç»Ÿå°±ä¼šè¯»å–ä»»åŠ¡é˜Ÿåˆ—ï¼Œå°†å¯è¿è¡Œçš„å¼‚æ­¥ä»»åŠ¡æ·»åŠ åˆ°å¯æ‰§è¡Œæ ˆä¸­ï¼Œå¼€å§‹æ‰§è¡Œã€‚</li></ul><h3 id="å®ä»»åŠ¡" tabindex="-1">å®ä»»åŠ¡ <a class="header-anchor" href="#å®ä»»åŠ¡" aria-label="Permalink to &quot;å®ä»»åŠ¡&quot;">â€‹</a></h3><p><code>(macro)task</code>ï¼ˆåˆç§°ä¹‹ä¸ºå®ä»»åŠ¡ï¼‰ï¼Œå¯ä»¥ç†è§£æ˜¯æ¯æ¬¡æ‰§è¡Œæ ˆæ‰§è¡Œçš„ä»£ç å°±æ˜¯ä¸€ä¸ªå®ä»»åŠ¡ï¼ˆåŒ…æ‹¬æ¯æ¬¡ä»äº‹ä»¶é˜Ÿåˆ—ä¸­è·å–ä¸€ä¸ªäº‹ä»¶å›è°ƒå¹¶æ”¾åˆ°æ‰§è¡Œæ ˆä¸­æ‰§è¡Œï¼‰ã€‚</p><p>æµè§ˆå™¨ä¸ºäº†èƒ½å¤Ÿä½¿å¾— JS å†…éƒ¨ <code>(macro)task</code> ä¸ <code>DOM</code> ä»»åŠ¡èƒ½å¤Ÿæœ‰åºçš„æ‰§è¡Œï¼Œ<strong><em>ä¼šåœ¨ä¸€ä¸ª(macro)task æ‰§è¡Œç»“æŸåï¼Œåœ¨ä¸‹ä¸€ä¸ª(macro)task æ‰§è¡Œå¼€å§‹å‰ï¼Œå¯¹é¡µé¢è¿›è¡Œé‡æ–°æ¸²æŸ“ï¼Œæµç¨‹å¦‚ä¸‹ï¼š</em></strong></p><p><code>(macro)task-&gt; æ¸²æŸ“ -&gt;(macro)task-&gt;...</code></p><p>æŒ‰ç…§è§„å®šï¼Œèƒ½å‘èµ·å®è§‚ä»»åŠ¡çš„æ–¹æ³•æœ‰ï¼š</p><ul><li>script(æ•´ä½“ä»£ç )ã€<code>setTimeout</code>ã€ <code>setInterval</code>ã€<code>I/O</code>ã€UI äº¤äº’äº‹ä»¶ã€<code>postMessage</code>ã€<code>MessageChannel</code>ã€<code>setImmediate</code>(Node.js ç¯å¢ƒ)ï¼›</li></ul><h3 id="å¾®ä»»åŠ¡" tabindex="-1">å¾®ä»»åŠ¡ <a class="header-anchor" href="#å¾®ä»»åŠ¡" aria-label="Permalink to &quot;å¾®ä»»åŠ¡&quot;">â€‹</a></h3><p>microtaskï¼ˆåˆç§°ä¸ºå¾®ä»»åŠ¡ï¼‰ï¼Œå¯ä»¥ç†è§£æ˜¯ <strong><em>åœ¨å½“å‰ task æ‰§è¡Œç»“æŸåç«‹å³æ‰§è¡Œçš„ä»»åŠ¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨å½“å‰ task ä»»åŠ¡åï¼Œä¸‹ä¸€ä¸ª task ä¹‹å‰ï¼Œåœ¨æ¸²æŸ“ä¹‹å‰ã€‚</em></strong></p><p>æ‰€ä»¥å®ƒçš„å“åº”é€Ÿåº¦ç›¸æ¯”<code>setTimeout</code>ï¼ˆ <code>setTimeout</code> æ˜¯ <code>task</code> ï¼‰ä¼šæ›´å¿«ï¼Œå› ä¸ºæ— éœ€ç­‰æ¸²æŸ“ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æŸä¸€ä¸ª <code>macrotask</code> æ‰§è¡Œå®Œåï¼Œå°±ä¼šå°†åœ¨å®ƒæ‰§è¡ŒæœŸé—´äº§ç”Ÿçš„æ‰€æœ‰ <code>microtask</code> éƒ½æ‰§è¡Œå®Œæ¯•ï¼ˆåœ¨æ¸²æŸ“å‰ï¼‰ã€‚</p><p><code>microtask</code> ä¸»è¦åŒ…å«ï¼š <code>Promise.then</code>ã€<code>MutaionObserver</code>ã€<code>process.nextTick</code>(<code>Node.js</code> ç¯å¢ƒ)ã€‚<code>async/await</code>å®é™…ä¸Šæ˜¯ <code>promise+generator</code> çš„è¯­æ³•ç³–ï¼Œä¹Ÿå°±æ˜¯<code>promise</code>ï¼Œä¹Ÿå°±æ˜¯å¾®è§‚ä»»åŠ¡ã€‚</p><h3 id="è¿è¡Œæœºåˆ¶" tabindex="-1">è¿è¡Œæœºåˆ¶ <a class="header-anchor" href="#è¿è¡Œæœºåˆ¶" aria-label="Permalink to &quot;è¿è¡Œæœºåˆ¶&quot;">â€‹</a></h3><p><strong>åœ¨äº‹ä»¶å¾ªç¯ä¸­ï¼Œæ¯è¿›è¡Œä¸€æ¬¡å¾ªç¯æ“ä½œç§°ä¸º tickï¼Œæ¯ä¸€æ¬¡ tick çš„ä»»åŠ¡å¤„ç†æ¨¡å‹æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œä½†å…³é”®æ­¥éª¤å¦‚ä¸‹ï¼š</strong></p><ul><li>æ‰§è¡Œä¸€ä¸ªå®ä»»åŠ¡ï¼ˆæ ˆä¸­æ²¡æœ‰å°±ä»äº‹ä»¶é˜Ÿåˆ—ä¸­è·å–ï¼‰</li><li>æ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚æœé‡åˆ°å¾®ä»»åŠ¡ï¼Œå°±å°†å®ƒæ·»åŠ åˆ°å¾®ä»»åŠ¡çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­ã€‚</li><li>å®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œç«‹å³æ‰§è¡Œå½“å‰å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰å¾®ä»»åŠ¡ã€‚ï¼ˆæ³¨æ„ï¼ï¼æ‰§è¡Œé¡ºåºä¹Ÿæ˜¯æŒ‰ç…§äº§ç”Ÿé¡ºåºæ¥çš„ï¼‰</li><li>å½“å‰å®ä»»åŠ¡å®Œå…¨æ‰§è¡Œåï¼Œå¼€å§‹æ£€æŸ¥æ¸²æŸ“ï¼Œç„¶å GUI çº¿ç¨‹æ¥ç®¡æ¸²æŸ“ã€‚</li><li>æ¸²æŸ“å®Œæ¯•åï¼ŒJS çº¿ç¨‹ç»§ç»­æ¥ç®¡ï¼Œå¼€å§‹ä¸‹ä¸€ä¸ªå®ä»»åŠ¡ï¼ˆä»äº‹ä»¶é˜Ÿåˆ—ä¸­è·å–ï¼‰</li></ul><blockquote><p><strong>æµç¨‹å›¾å¤§è‡´å¦‚ä¸‹ï¼š</strong></p></blockquote><p><img src="http://image.jinghao.xyz/blog/20200609/eQDAFjpr6XlQ.png" alt="mark"></p><h3 id="promise-å’Œ-async-ä¸­çš„ç«‹å³æ‰§è¡Œ" tabindex="-1">Promise å’Œ async ä¸­çš„ç«‹å³æ‰§è¡Œ <a class="header-anchor" href="#promise-å’Œ-async-ä¸­çš„ç«‹å³æ‰§è¡Œ" aria-label="Permalink to &quot;Promise å’Œ async ä¸­çš„ç«‹å³æ‰§è¡Œ&quot;">â€‹</a></h3><p>æˆ‘ä»¬çŸ¥é“ <code>Promise</code> ä¸­çš„å¼‚æ­¥ä½“ç°åœ¨ <code>then</code> å’Œ <code>catch</code> ä¸­ï¼Œæ‰€ä»¥å†™åœ¨ <code>Promise</code> ä¸­çš„ä»£ç æ˜¯è¢«å½“åšåŒæ­¥ä»»åŠ¡ç«‹å³æ‰§è¡Œçš„ã€‚è€Œåœ¨<code>async/await</code> ä¸­ï¼Œåœ¨å‡ºç° <code>await</code> å‡ºç°ä¹‹å‰ï¼Œå…¶ä¸­çš„ä»£ç ä¹Ÿæ˜¯ç«‹å³æ‰§è¡Œçš„ã€‚é‚£ä¹ˆå‡ºç°äº† <code>await</code> æ—¶å€™å‘ç”Ÿäº†ä»€ä¹ˆå‘¢ï¼Ÿ</p><h3 id="await-åšäº†ä»€ä¹ˆ" tabindex="-1">await åšäº†ä»€ä¹ˆ <a class="header-anchor" href="#await-åšäº†ä»€ä¹ˆ" aria-label="Permalink to &quot;await åšäº†ä»€ä¹ˆ&quot;">â€‹</a></h3><p>ä»å­—é¢æ„æ€ä¸Šçœ‹ <code>await</code> å°±æ˜¯ç­‰å¾…ï¼Œ <code>await</code> ç­‰å¾…çš„æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¿™ä¸ªè¡¨è¾¾å¼çš„è¿”å›å€¼å¯ä»¥æ˜¯ä¸€ä¸ª <code>promise</code> å¯¹è±¡ä¹Ÿå¯ä»¥æ˜¯å…¶ä»–å€¼ã€‚</p><p>å¾ˆå¤šäººä»¥ä¸º <code>await</code> ä¼šä¸€ç›´ç­‰å¾…ä¹‹åçš„è¡¨è¾¾å¼æ‰§è¡Œå®Œä¹‹åæ‰ä¼šç»§ç»­æ‰§è¡Œåé¢çš„ä»£ç ï¼Œ<strong>å®é™…ä¸Š <code>await</code> æ˜¯ä¸€ä¸ªè®©å‡ºçº¿ç¨‹çš„æ ‡å¿—ã€‚await åé¢çš„è¡¨è¾¾å¼ä¼šå…ˆæ‰§è¡Œä¸€éï¼Œå°† <code>await</code> åé¢çš„ä»£ç åŠ å…¥åˆ° <code>microtask</code> ä¸­ï¼Œç„¶åå°±ä¼šè·³å‡ºæ•´ä¸ª <code>async</code> å‡½æ•°æ¥æ‰§è¡Œåé¢çš„ä»£ç ã€‚</strong> ç”±äºå› ä¸º<code>async await</code> æœ¬èº«å°±æ˜¯ <code>promise+generator</code> çš„è¯­æ³•ç³–ã€‚æ‰€ä»¥ <code>await</code> åé¢çš„ä»£ç æ˜¯ <code>microtask</code>ã€‚æ‰€ä»¥å¯¹äºæœ¬é¢˜ä¸­çš„</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">async1</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">async1 start</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">async2</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">async1 end</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>ç­‰ä»·äºå¦‚ä¸‹ï¼š</p><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">async1</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">async1 start</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">async2</span><span style="color:#F07178;">())</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">async1 end</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="è§£é¢˜è¿‡ç¨‹" tabindex="-1">è§£é¢˜è¿‡ç¨‹ <a class="header-anchor" href="#è§£é¢˜è¿‡ç¨‹" aria-label="Permalink to &quot;è§£é¢˜è¿‡ç¨‹&quot;">â€‹</a></h3><ul><li>1ã€é¦–å…ˆï¼Œäº‹ä»¶å¾ªç¯ä»å®ä»»åŠ¡(macrotask)é˜Ÿåˆ—å¼€å§‹ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå®ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œåªæœ‰ä¸€ä¸ª <code>script</code> (æ•´ä½“ä»£ç )ä»»åŠ¡ï¼›å½“é‡åˆ°ä»»åŠ¡æº <code>(task source)</code> æ—¶ï¼Œåˆ™ä¼šå…ˆåˆ†å‘ä»»åŠ¡åˆ°å¯¹åº”çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­å»ã€‚æ‰€ä»¥ï¼Œä¸Šé¢ä¾‹å­çš„ç¬¬ä¸€æ­¥æ‰§è¡Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</li></ul><p><img src="http://image.jinghao.xyz/blog/20200523/scMMNrd2WzgK.png" alt="mark"></p><ul><li>2ã€ç„¶åæˆ‘ä»¬çœ‹åˆ°é¦–å…ˆå®šä¹‰äº†ä¸¤ä¸ª async å‡½æ•°ï¼Œæ¥ç€å¾€ä¸‹çœ‹ï¼Œç„¶åé‡åˆ°äº† console è¯­å¥ï¼Œç›´æ¥è¾“å‡º script startã€‚è¾“å‡ºä¹‹åï¼Œscript ä»»åŠ¡ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œé‡åˆ° setTimeoutï¼Œå…¶ä½œä¸ºä¸€ä¸ªå®ä»»åŠ¡æºï¼Œåˆ™ä¼šå…ˆå°†å…¶ä»»åŠ¡åˆ†å‘åˆ°å¯¹åº”çš„é˜Ÿåˆ—ä¸­ï¼š</li></ul><p><img src="http://image.jinghao.xyz/blog/20200523/CiOoJMlOe2qa.png" alt="mark"></p><ul><li>3ã€<code>script</code> ä»»åŠ¡ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œæ‰§è¡Œäº† <code>async1()</code> å‡½æ•°ï¼Œå‰é¢è®²è¿‡ async å‡½æ•°ä¸­åœ¨ <code>await</code> ä¹‹å‰çš„ä»£ç æ˜¯ç«‹å³æ‰§è¡Œçš„ï¼Œæ‰€ä»¥ä¼šç«‹å³è¾“å‡º <strong><em>async1 start</em></strong>ã€‚</li></ul><p>é‡åˆ°äº† <code>await</code> æ—¶ï¼Œä¼šå°† <code>await</code> åé¢çš„è¡¨è¾¾å¼æ‰§è¡Œä¸€éï¼Œæ‰€ä»¥å°±ç´§æ¥ç€è¾“å‡º <code>async</code>2ï¼Œç„¶åå°† <code>await</code> åé¢çš„ä»£ç ä¹Ÿå°±æ˜¯ <code>console.log(&#39;async1 end&#39;)</code> åŠ å…¥åˆ° <code>microtask</code> ä¸­çš„ <code>Promise</code> é˜Ÿåˆ—ä¸­ï¼Œæ¥ç€è·³å‡º <code>async1</code> å‡½æ•°æ¥æ‰§è¡Œåé¢çš„ä»£ç ã€‚</p><p><img src="http://image.jinghao.xyz/blog/20200523/spj15G9advzk.png" alt="mark"></p><ul><li>4ã€<code>script</code> ä»»åŠ¡ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œé‡åˆ° <code>Promise</code> å®ä¾‹ã€‚ç”±äº <code>Promise</code> ä¸­çš„å‡½æ•°æ˜¯ç«‹å³æ‰§è¡Œçš„ï¼Œè€Œåç»­çš„ <code>.then</code> åˆ™ä¼šè¢«åˆ†å‘åˆ° <code>microtask</code> çš„ <code>Promise</code> é˜Ÿåˆ—ä¸­å»ã€‚æ‰€ä»¥ä¼šå…ˆè¾“å‡º promise1ï¼Œç„¶åæ‰§è¡Œ <code>resolve</code>ï¼Œå°† <code>promise2</code> åˆ†é…åˆ°å¯¹åº”é˜Ÿåˆ—ã€‚</li></ul><p><img src="http://image.jinghao.xyz/blog/20200523/RaiHbtdVUqXa.png" alt="mark"></p><ul><li><p>5ã€<code>script</code> ä»»åŠ¡ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œæœ€ååªæœ‰ä¸€å¥è¾“å‡ºäº† <code>script end</code>ï¼Œè‡³æ­¤ï¼Œå…¨å±€ä»»åŠ¡å°±æ‰§è¡Œå®Œæ¯•äº†ã€‚</p></li><li><p>6ã€æ ¹æ®ä¸Šè¿°ï¼Œæ¯æ¬¡æ‰§è¡Œå®Œä¸€ä¸ªå®ä»»åŠ¡ä¹‹åï¼Œä¼šå»æ£€æŸ¥æ˜¯å¦å­˜åœ¨ <code>Microtasks</code>ï¼›å¦‚æœæœ‰ï¼Œåˆ™æ‰§è¡Œ <code>Microtasks</code> ç›´è‡³æ¸…ç©º <code>Microtask Queue</code>ã€‚å› è€Œåœ¨<code>script</code>ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œå¼€å§‹æŸ¥æ‰¾æ¸…ç©ºå¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚æ­¤æ—¶ï¼Œå¾®ä»»åŠ¡ä¸­ï¼Œ <code>Promise</code> é˜Ÿåˆ—æœ‰çš„ä¸¤ä¸ªä»»åŠ¡ <code>async1 end</code> å’Œ <code>promise2</code> ï¼Œå› æ­¤æŒ‰å…ˆåé¡ºåºè¾“å‡º <code>async1 end</code> ï¼Œ<code>promise2</code>ã€‚å½“æ‰€æœ‰çš„ <code>Microtasks</code> æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œè¡¨ç¤ºç¬¬ä¸€è½®çš„å¾ªç¯å°±ç»“æŸäº†ã€‚</p></li><li><p>7ã€ç¬¬äºŒè½®å¾ªç¯ä¾æ—§ä»å®ä»»åŠ¡é˜Ÿåˆ—å¼€å§‹ã€‚æ­¤æ—¶å®ä»»åŠ¡ä¸­åªæœ‰ä¸€ä¸ª <code>setTimeout</code>ï¼Œå–å‡ºç›´æ¥è¾“å‡ºå³å¯ï¼Œè‡³æ­¤æ•´ä¸ªæµç¨‹ç»“æŸã€‚</p></li></ul><h3 id="æœ€ç»ˆç»“æœ" tabindex="-1">æœ€ç»ˆç»“æœ <a class="header-anchor" href="#æœ€ç»ˆç»“æœ" aria-label="Permalink to &quot;æœ€ç»ˆç»“æœ&quot;">â€‹</a></h3><details class="details custom-block"><summary>ç¨‹åºç»“æœ</summary><p>script start async1 start async2 promise1 script end async1 end promise2 setTimeout</p></details><h3 id="ç›¸ä¼¼é¢˜ä¸€" tabindex="-1">ç›¸ä¼¼é¢˜ä¸€ <a class="header-anchor" href="#ç›¸ä¼¼é¢˜ä¸€" aria-label="Permalink to &quot;ç›¸ä¼¼é¢˜ä¸€&quot;">â€‹</a></h3><ul><li>å°† <code>async2</code> ä¸­çš„å‡½æ•°ä¹Ÿå˜æˆäº† <code>Promise</code> å‡½æ•°ï¼Œä»£ç å¦‚ä¸‹ï¼š</li></ul><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">async1</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">async1 start</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">async2</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">async1 end</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">async2</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;font-style:italic;">//async2åšå‡ºå¦‚ä¸‹æ›´æ”¹ï¼š</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#F07178;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">promise1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#F07178;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">promise2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">script start</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setTimeout</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">setTimeout</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">async1</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">promise3</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">promise4</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">script end</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><details class="details custom-block"><summary>ç¨‹åºç»“æœ</summary><p>script start async1 start promise1 promise3 script end promise2 async1 end promise4 setTimeout</p></details><h3 id="ç›¸ä¼¼é¢˜äºŒ" tabindex="-1">ç›¸ä¼¼é¢˜äºŒ <a class="header-anchor" href="#ç›¸ä¼¼é¢˜äºŒ" aria-label="Permalink to &quot;ç›¸ä¼¼é¢˜äºŒ&quot;">â€‹</a></h3><ul><li>å°† <code>async1</code> ä¸­ <code>await</code> åé¢çš„ä»£ç å’Œ <code>async2</code> çš„ä»£ç éƒ½æ”¹ä¸ºå¼‚æ­¥çš„ï¼Œä»£ç å¦‚ä¸‹ï¼š</li></ul><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">async1</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">async1 start</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">async2</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;font-style:italic;">//æ›´æ”¹å¦‚ä¸‹ï¼š</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">setTimeout1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">async2</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;font-style:italic;">//æ›´æ”¹å¦‚ä¸‹ï¼š</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">		</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">setTimeout2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">script start</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setTimeout</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">setTimeout3</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#82AAFF;">async1</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">promise1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">promise2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">script end</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><details class="details custom-block"><summary>ç¨‹åºç»“æœ</summary><p>script start async1 start promise1 script end promise2 setTimeout3 setTimeout2 setTimeout1</p></details><h2 id="äºŒã€node-ä¸­çš„-javascript-äº‹ä»¶å¾ªç¯æœºåˆ¶" tabindex="-1">äºŒã€node ä¸­çš„ JavaScript äº‹ä»¶å¾ªç¯æœºåˆ¶ <a class="header-anchor" href="#äºŒã€node-ä¸­çš„-javascript-äº‹ä»¶å¾ªç¯æœºåˆ¶" aria-label="Permalink to &quot;äºŒã€node ä¸­çš„ JavaScript äº‹ä»¶å¾ªç¯æœºåˆ¶&quot;">â€‹</a></h2><h3 id="node-çš„å¾®ä»»åŠ¡å’Œå®ä»»åŠ¡" tabindex="-1">Node çš„å¾®ä»»åŠ¡å’Œå®ä»»åŠ¡ <a class="header-anchor" href="#node-çš„å¾®ä»»åŠ¡å’Œå®ä»»åŠ¡" aria-label="Permalink to &quot;Node çš„å¾®ä»»åŠ¡å’Œå®ä»»åŠ¡&quot;">â€‹</a></h3><h4 id="æˆ‘ä»¬ä¼šå‘ç°ä»ä¸€æ¬¡äº‹ä»¶å¾ªç¯çš„-tick-æ¥è¯´-node-çš„äº‹ä»¶å¾ªç¯æ›´å¤æ‚-å®ƒä¹Ÿåˆ†ä¸ºå¾®ä»»åŠ¡å’Œå®ä»»åŠ¡" tabindex="-1">æˆ‘ä»¬ä¼šå‘ç°ä»ä¸€æ¬¡äº‹ä»¶å¾ªç¯çš„ Tick æ¥è¯´ï¼ŒNode çš„äº‹ä»¶å¾ªç¯æ›´å¤æ‚ï¼Œå®ƒä¹Ÿåˆ†ä¸ºå¾®ä»»åŠ¡å’Œå®ä»»åŠ¡ï¼š <a class="header-anchor" href="#æˆ‘ä»¬ä¼šå‘ç°ä»ä¸€æ¬¡äº‹ä»¶å¾ªç¯çš„-tick-æ¥è¯´-node-çš„äº‹ä»¶å¾ªç¯æ›´å¤æ‚-å®ƒä¹Ÿåˆ†ä¸ºå¾®ä»»åŠ¡å’Œå®ä»»åŠ¡" aria-label="Permalink to &quot;æˆ‘ä»¬ä¼šå‘ç°ä»ä¸€æ¬¡äº‹ä»¶å¾ªç¯çš„ Tick æ¥è¯´ï¼ŒNode çš„äº‹ä»¶å¾ªç¯æ›´å¤æ‚ï¼Œå®ƒä¹Ÿåˆ†ä¸ºå¾®ä»»åŠ¡å’Œå®ä»»åŠ¡ï¼š&quot;">â€‹</a></h4><ul><li>å®ä»»åŠ¡ï¼ˆmacrotaskï¼‰ï¼šsetTimeoutã€setIntervalã€IO äº‹ä»¶ã€setImmediateã€close äº‹ä»¶ï¼›</li><li>å¾®ä»»åŠ¡ï¼ˆmicrotaskï¼‰ï¼šPromise çš„ then å›è°ƒã€process.nextTickã€queueMicrotask.</li></ul><h4 id="ä½†æ˜¯-node-ä¸­çš„äº‹ä»¶å¾ªç¯ä¸æµè§ˆå™¨æœ‰ä¸€äº›å·®åˆ«" tabindex="-1">ä½†æ˜¯ï¼ŒNode ä¸­çš„äº‹ä»¶å¾ªç¯ä¸æµè§ˆå™¨æœ‰ä¸€äº›å·®åˆ«ï¼š <a class="header-anchor" href="#ä½†æ˜¯-node-ä¸­çš„äº‹ä»¶å¾ªç¯ä¸æµè§ˆå™¨æœ‰ä¸€äº›å·®åˆ«" aria-label="Permalink to &quot;ä½†æ˜¯ï¼ŒNode ä¸­çš„äº‹ä»¶å¾ªç¯ä¸æµè§ˆå™¨æœ‰ä¸€äº›å·®åˆ«ï¼š&quot;">â€‹</a></h4><ul><li>å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼š next tick queueï¼šprocess.nextTick other queueï¼šPromise çš„ then å›è°ƒã€queueMicrotask</li><li>å®ä»»åŠ¡é˜Ÿåˆ—ï¼š timer queueï¼šsetTimeoutã€setInterval poll queueï¼šIO äº‹ä»¶ check queueï¼šsetImmediate close queueï¼šclose äº‹ä»¶</li></ul><h3 id="node-ä¸­çš„äº‹ä»¶å¾ªç¯ä¼˜å…ˆçº§" tabindex="-1">Node ä¸­çš„äº‹ä»¶å¾ªç¯ä¼˜å…ˆçº§ <a class="header-anchor" href="#node-ä¸­çš„äº‹ä»¶å¾ªç¯ä¼˜å…ˆçº§" aria-label="Permalink to &quot;Node ä¸­çš„äº‹ä»¶å¾ªç¯ä¼˜å…ˆçº§&quot;">â€‹</a></h3><p><img src="http://image.jinghao.xyz/iShot2021-01-18%2011.01.09.png" alt="mark"></p><p><strong>main script -&gt; nextTicks -&gt; other microtask -&gt; times -&gt; immediate -&gt; ä¸‹ä¸€ä¸ªå®ä»»åŠ¡ã€‚</strong></p><h3 id="æ¥ä¸ªä¾‹é¢˜åˆ†æä¸€ä¸‹" tabindex="-1">æ¥ä¸ªä¾‹é¢˜åˆ†æä¸€ä¸‹ <a class="header-anchor" href="#æ¥ä¸ªä¾‹é¢˜åˆ†æä¸€ä¸‹" aria-label="Permalink to &quot;æ¥ä¸ªä¾‹é¢˜åˆ†æä¸€ä¸‹&quot;">â€‹</a></h3><div class="language-js line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">async1</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">async1 start</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">async2</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">async1 end</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">setImmediate</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">setImmediate</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">async2</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">async2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">script start</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">setTimeout</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">setTimeout0</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">process</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">nextTick</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">nextTick1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">async1</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">process</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">nextTick</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">nextTick2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">promise1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">promise2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">	</span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">promise3</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">script end</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><ul><li><p>æŒ‰ç…§ä¸Šé¢ç†è®ºåˆ†æç»“æœå¦‚ä¸‹å›¾</p></li><li><p>æ³¨æ„ä¸€ç‚¹ promise é‡Œé¢æ‰§è¡Œ resolve() å å³æ‰§è¡Œ then() æŠŠå›è°ƒå‡½æ•°åŠ å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—é‡Œé¢ã€‚</p></li><li><p>æ³¨æ„ä¸¤ç‚¹ await åé¢ç›¸å½“äº new promise ä¸€æ ·ï¼Œç›´æ¥æ‰§è¡Œã€‚åé¢çš„ä»£ç æ‰ä¼šåŠ å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚ <img src="http://image.jinghao.xyz/nodeeventloopresult.png" alt="mark"></p></li><li><p>ç„¶åä¾æ¬¡æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p></li></ul><details class="details custom-block"><summary>ç¨‹åºç»“æœ</summary><p>script start async1 start async2 promise1 promise2 script end nextTick1 nextTick2 async1 end promise3 setTimeout0 setImmediate</p></details><h3 id="settimeout-å›è°ƒå‡½æ•°-0-ã€setimmediate-å›è°ƒå‡½æ•°-æ‰§è¡Œé¡ºåºåˆ†æ" tabindex="-1">setTimeout(å›è°ƒå‡½æ•°, 0)ã€setImmediate(å›è°ƒå‡½æ•°)æ‰§è¡Œé¡ºåºåˆ†æ <a class="header-anchor" href="#settimeout-å›è°ƒå‡½æ•°-0-ã€setimmediate-å›è°ƒå‡½æ•°-æ‰§è¡Œé¡ºåºåˆ†æ" aria-label="Permalink to &quot;setTimeout(å›è°ƒå‡½æ•°, 0)ã€setImmediate(å›è°ƒå‡½æ•°)æ‰§è¡Œé¡ºåºåˆ†æ&quot;">â€‹</a></h3><ul><li><p>é¦–å…ˆç»“è®ºæ˜¯ï¼šè¿™ä¸¤ä¸ªåœ¨ node ä¸­çš„æ‰§è¡Œé¡ºåºæ˜¯ä¸ç¡®å®šçš„ã€‚</p></li><li><p>è°å…ˆæ‰§è¡Œå–å†³äºäº‹ä»¶å¾ªç¯å¼€å¯çš„æ—¶é—´ ä¸ setTimeout å‡½æ•°çš„æ‰§è¡Œæ—¶é—´çš„å¤§å°å…³ç³»ã€‚åœ¨ Node æºç çš„ deps/uv/src/timer.c ä¸­ 141 è¡Œï¼Œæœ‰ä¸€ä¸ª uv__next_timeout çš„å‡½æ•°å†³å®šäº†è¿™ä¸¤ä¸ªçš„æ‰§è¡Œé¡ºåºã€‚</p></li><li><p>æƒ…å†µä¸€ï¼šå¦‚æœäº‹ä»¶å¾ªç¯å¼€å¯çš„æ—¶é—´å°äº setTimeout å‡½æ•°çš„æ‰§è¡Œæ—¶é—´çš„ï¼Œä¹Ÿå°±æ„å‘³ç€å…ˆå¼€å¯äº† event-loopï¼Œè¿™ä¸ªæ—¶å€™æ‰§è¡Œåˆ° timer é˜¶æ®µï¼Œå¹¶æ²¡æœ‰ å®šæ—¶å™¨çš„å›è°ƒè¢«æ”¾åˆ°å…¥ timer queue ä¸­ï¼›æ‰€ä»¥æ²¡æœ‰è¢«æ‰§è¡Œï¼Œè¿™ä¸ªæ—¶å€™æ˜¯å…ˆæ£€æµ‹ setImmediateï¼Œç¬¬äºŒæ¬¡çš„ tick ä¸­æ‰§è¡Œäº† timer ä¸­çš„ setTimeoutã€‚</p><p><strong>å³ å…ˆ setImmediate å setTimeoutã€‚</strong></p></li><li><p>æƒ…å†µäºŒï¼šå¦‚æœäº‹ä»¶å¾ªç¯å¼€å¯çš„æ—¶é—´å¤§äº setTimeout å‡½æ•°çš„æ‰§è¡Œæ—¶é—´çš„ï¼› è¿™å°±æ„å‘³ç€åœ¨ç¬¬ä¸€æ¬¡ tick ä¸­ï¼Œå·²ç»å‡†å¤‡å¥½äº† timer queueï¼›æ‰€ä»¥ä¼šç›´æ¥æŒ‰ç…§é¡ºåºæ‰§è¡Œå³å¯ã€‚</p><p><strong>å³ å…ˆ setTimeout å setImmediateã€‚</strong></p></li></ul>`,68),e=[o];function c(t,r,F,y,D,i){return n(),a("div",null,e)}const d=s(p,[["render",c]]);export{C as __pageData,d as default};
